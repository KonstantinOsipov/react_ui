{"ast":null,"code":"var _jsxFileName = \"/home/konstantin/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/react_ui/src/components/Web3_Custom_EIP712Sign_API.js\";\nimport React, { useState, useEffect } from \"react\";\nimport \"../App.css\";\nimport Button from \"@material-ui/core/Button\";\nimport { NotificationContainer, NotificationManager } from \"react-notifications\";\nimport \"react-notifications/lib/notifications.css\";\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Web3 from \"web3\";\nimport { Biconomy } from \"@biconomy/mexa\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport Link from '@material-ui/core/Link';\nimport Typography from '@material-ui/core/Typography';\nimport { Box } from \"@material-ui/core\";\n\nlet sigUtil = require(\"eth-sig-util\");\n\nlet config = {\n  contract: {\n    address: \"0x853bfD0160d67DF13a9F70409f9038f6473585Bd\",\n    abi: [{\n      \"anonymous\": false,\n      \"inputs\": [{\n        \"indexed\": false,\n        \"internalType\": \"address\",\n        \"name\": \"userAddress\",\n        \"type\": \"address\"\n      }, {\n        \"indexed\": false,\n        \"internalType\": \"addresspayable\",\n        \"name\": \"relayerAddress\",\n        \"type\": \"address\"\n      }, {\n        \"indexed\": false,\n        \"internalType\": \"bytes\",\n        \"name\": \"functionSignature\",\n        \"type\": \"bytes\"\n      }],\n      \"name\": \"MetaTransactionExecuted\",\n      \"type\": \"event\"\n    }, {\n      \"inputs\": [{\n        \"internalType\": \"address\",\n        \"name\": \"userAddress\",\n        \"type\": \"address\"\n      }, {\n        \"internalType\": \"bytes\",\n        \"name\": \"functionSignature\",\n        \"type\": \"bytes\"\n      }, {\n        \"internalType\": \"bytes32\",\n        \"name\": \"sigR\",\n        \"type\": \"bytes32\"\n      }, {\n        \"internalType\": \"bytes32\",\n        \"name\": \"sigS\",\n        \"type\": \"bytes32\"\n      }, {\n        \"internalType\": \"uint8\",\n        \"name\": \"sigV\",\n        \"type\": \"uint8\"\n      }],\n      \"name\": \"executeMetaTransaction\",\n      \"outputs\": [{\n        \"internalType\": \"bytes\",\n        \"name\": \"\",\n        \"type\": \"bytes\"\n      }],\n      \"stateMutability\": \"payable\",\n      \"type\": \"function\"\n    }, {\n      \"inputs\": [{\n        \"internalType\": \"address\",\n        \"name\": \"user\",\n        \"type\": \"address\"\n      }],\n      \"name\": \"getNonce\",\n      \"outputs\": [{\n        \"internalType\": \"uint256\",\n        \"name\": \"nonce\",\n        \"type\": \"uint256\"\n      }],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    }, {\n      \"inputs\": [],\n      \"name\": \"getQuote\",\n      \"outputs\": [{\n        \"internalType\": \"string\",\n        \"name\": \"currentQuote\",\n        \"type\": \"string\"\n      }, {\n        \"internalType\": \"address\",\n        \"name\": \"currentOwner\",\n        \"type\": \"address\"\n      }],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    }, {\n      \"inputs\": [],\n      \"name\": \"owner\",\n      \"outputs\": [{\n        \"internalType\": \"address\",\n        \"name\": \"\",\n        \"type\": \"address\"\n      }],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    }, {\n      \"inputs\": [],\n      \"name\": \"quote\",\n      \"outputs\": [{\n        \"internalType\": \"string\",\n        \"name\": \"\",\n        \"type\": \"string\"\n      }],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    }, {\n      \"inputs\": [{\n        \"internalType\": \"string\",\n        \"name\": \"newQuote\",\n        \"type\": \"string\"\n      }],\n      \"name\": \"setQuote\",\n      \"outputs\": [],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    }]\n  },\n  apiKey: {\n    test: \"cNWqZcoBb.4e4c0990-26a8-4a45-b98e-08101f754119\",\n    prod: \"8nvA_lM_Q.0424c54e-b4b2-4550-98c5-8b437d3118a9\"\n  },\n  api: {\n    test: \"https://test-api.biconomy.io\",\n    prod: \"https://api.biconomy.io\"\n  }\n};\nconst domainType = [{\n  name: \"name\",\n  type: \"string\"\n}, {\n  name: \"version\",\n  type: \"string\"\n}, {\n  name: \"verifyingContract\",\n  type: \"address\"\n}, {\n  name: \"salt\",\n  type: \"bytes32\"\n}];\nconst metaTransactionType = [{\n  name: \"nonce\",\n  type: \"uint256\"\n}, {\n  name: \"from\",\n  type: \"address\"\n}, {\n  name: \"functionSignature\",\n  type: \"bytes\"\n}];\nlet domainData = {\n  name: \"TestContract\",\n  version: \"1\",\n  verifyingContract: config.contract.address,\n  salt: '0x' + 42 .toString(16).padStart(64, '0')\n};\nlet web3, walletWeb3;\nlet contract;\nconst useStyles = makeStyles(theme => ({\n  root: {\n    '& > * + *': {\n      marginLeft: theme.spacing(2)\n    }\n  },\n  link: {\n    marginLeft: \"5px\"\n  },\n  backdrop: {\n    zIndex: theme.zIndex.drawer + 1,\n    color: '#fff',\n    opacity: '.85!important',\n    background: '#000'\n  }\n}));\n\nfunction App() {\n  const classes = useStyles();\n\n  const preventDefault = event => event.preventDefault();\n\n  const [backdropOpen, setBackdropOpen] = React.useState(true);\n  const [loadingMessage, setLoadingMessage] = React.useState(\" Loading Application ...\");\n  const [quote, setQuote] = useState(\"This is a default quote\");\n  const [owner, setOwner] = useState(\"Default Owner Address\");\n  const [newQuote, setNewQuote] = useState(\"\");\n  const [selectedAddress, setSelectedAddress] = useState(\"\");\n  const [metaTxEnabled, setMetaTxEnabled] = useState(true);\n  const [transactionHash, setTransactionHash] = useState(\"\");\n  useEffect(() => {\n    async function init() {\n      if (typeof window.ethereum !== \"undefined\" && window.ethereum.isMetaMask) {\n        // Ethereum user detected. You can now use the provider.\n        const provider = window[\"ethereum\"];\n        await provider.enable();\n        let kovanProvider = new Web3.providers.HttpProvider(\"https://kovan.infura.io/v3/d126f392798444609246423b06116c77\");\n        setLoadingMessage(\"Initializing Biconomy ...\");\n        const biconomy = new Biconomy(kovanProvider, {\n          apiKey: config.apiKey.prod,\n          debug: true\n        }); // This web3 instance is used to read normally and write to contract via meta transactions.\n\n        web3 = new Web3(biconomy); // This web3 instance is used to get user signature from connected wallet\n\n        walletWeb3 = new Web3(window.ethereum);\n        biconomy.onEvent(biconomy.READY, () => {\n          // Initialize your dapp here like getting user accounts etc\n          contract = new web3.eth.Contract(config.contract.abi, config.contract.address);\n          setSelectedAddress(provider.selectedAddress);\n          getQuoteFromNetwork();\n          provider.on(\"accountsChanged\", function (accounts) {\n            setSelectedAddress(accounts[0]);\n          });\n        }).onEvent(biconomy.ERROR, (error, message) => {// Handle error while initializing mexa\n        });\n      } else {\n        showErrorMessage(\"Metamask not installed\");\n      }\n    }\n\n    init();\n  }, []);\n\n  const handleClose = () => {\n    setBackdropOpen(false);\n  };\n\n  const handleToggle = () => {\n    setBackdropOpen(!backdropOpen);\n  };\n\n  const onQuoteChange = event => {\n    setNewQuote(event.target.value);\n  };\n\n  const onSubmitWithPrivateKey = async () => {\n    if (newQuote != \"\" && contract) {\n      setTransactionHash(\"\");\n\n      if (metaTxEnabled) {\n        console.log(\"Sending meta transaction\");\n        let privateKey = \"2ef295b86aa9d40ff8835a9fe852942ccea0b7c757fad5602dfa429bcdaea910\";\n        let userAddress = \"0xE1E763551A85F04B4687f0035885E7F710A46aA6\";\n        let nonce = await contract.methods.getNonce(userAddress).call();\n        let functionSignature = contract.methods.setQuote(newQuote).encodeABI();\n        let message = {};\n        message.nonce = parseInt(nonce);\n        message.from = userAddress;\n        message.functionSignature = functionSignature;\n        const dataToSign = {\n          types: {\n            EIP712Domain: domainType,\n            MetaTransaction: metaTransactionType\n          },\n          domain: domainData,\n          primaryType: \"MetaTransaction\",\n          message: message\n        };\n        const signature = sigUtil.signTypedMessage(new Buffer.from(privateKey, 'hex'), {\n          data: dataToSign\n        }, 'V4');\n        let {\n          r,\n          s,\n          v\n        } = getSignatureParameters(signature);\n        sendTransaction(userAddress, functionSignature, r, s, v);\n      } else {\n        console.log(\"Sending normal transaction\");\n        contract.methods.setQuote(newQuote).send({\n          from: selectedAddress\n        }).on(\"transactionHash\", function (hash) {\n          showInfoMessage(`Transaction sent to blockchain with hash ${hash}`);\n        }).once(\"confirmation\", function (confirmationNumber, receipt) {\n          setTransactionHash(receipt.transactionHash);\n          showSuccessMessage(\"Transaction confirmed\");\n          getQuoteFromNetwork();\n        });\n      }\n    } else {\n      showErrorMessage(\"Please enter the quote\");\n    }\n  };\n\n  const onSubmit = async event => {\n    if (newQuote != \"\" && contract) {\n      setTransactionHash(\"\");\n\n      if (metaTxEnabled) {\n        console.log(\"Sending meta transaction\");\n        let userAddress = selectedAddress;\n        let nonce = await contract.methods.getNonce(userAddress).call();\n        let functionSignature = contract.methods.setQuote(newQuote).encodeABI();\n        let message = {};\n        message.nonce = parseInt(nonce);\n        message.from = userAddress;\n        message.functionSignature = functionSignature;\n        const dataToSign = JSON.stringify({\n          types: {\n            EIP712Domain: domainType,\n            MetaTransaction: metaTransactionType\n          },\n          domain: domainData,\n          primaryType: \"MetaTransaction\",\n          message: message\n        }); // NOTE: Using walletWeb3 here, as it is connected to the wallet where user account is present.\n\n        walletWeb3.currentProvider.send({\n          jsonrpc: \"2.0\",\n          id: 999999999999,\n          method: \"eth_signTypedData_v4\",\n          params: [userAddress, dataToSign]\n        }, function (error, response) {\n          console.info(`User signature is ${response.result}`);\n\n          if (error || response && response.error) {\n            showErrorMessage(\"Could not get user signature\");\n          } else if (response && response.result) {\n            let {\n              r,\n              s,\n              v\n            } = getSignatureParameters(response.result);\n            sendTransaction(userAddress, functionSignature, r, s, v);\n          }\n        });\n      } else {\n        console.log(\"Sending normal transaction\");\n        contract.methods.setQuote(newQuote).send({\n          from: selectedAddress\n        }).on(\"transactionHash\", function (hash) {\n          showInfoMessage(`Transaction sent to blockchain with hash ${hash}`);\n        }).once(\"confirmation\", function (confirmationNumber, receipt) {\n          setTransactionHash(receipt.transactionHash);\n          showSuccessMessage(\"Transaction confirmed\");\n          getQuoteFromNetwork();\n        });\n      }\n    } else {\n      showErrorMessage(\"Please enter the quote\");\n    }\n  };\n\n  const getSignatureParameters = signature => {\n    if (!web3.utils.isHexStrict(signature)) {\n      throw new Error('Given value \"'.concat(signature, '\" is not a valid hex string.'));\n    }\n\n    var r = signature.slice(0, 66);\n    var s = \"0x\".concat(signature.slice(66, 130));\n    var v = \"0x\".concat(signature.slice(130, 132));\n    v = web3.utils.hexToNumber(v);\n    if (![27, 28].includes(v)) v += 27;\n    return {\n      r: r,\n      s: s,\n      v: v\n    };\n  };\n\n  const getQuoteFromNetwork = () => {\n    setLoadingMessage(\"Getting Quote from contact ...\");\n\n    try {\n      if (web3 && contract) {\n        contract.methods.getQuote().call().then(function (result) {\n          handleClose();\n          console.log(result);\n\n          if (result && result.currentQuote != undefined && result.currentOwner != undefined) {\n            if (result.currentQuote == \"\") {\n              showErrorMessage(\"No quotes set on blockchain yet\");\n            } else {\n              setQuote(result.currentQuote);\n              setOwner(result.currentOwner);\n            }\n          } else {\n            showErrorMessage(\"Not able to get quote information from Network\");\n          }\n        });\n      } else {\n        handleClose();\n      }\n    } catch (error) {\n      handleClose();\n      console.log(error);\n    }\n  };\n\n  const showErrorMessage = message => {\n    NotificationManager.error(message, \"Error\", 5000);\n  };\n\n  const showSuccessMessage = message => {\n    NotificationManager.success(message, \"Message\", 3000);\n  };\n\n  const showInfoMessage = message => {\n    NotificationManager.info(message, \"Info\", 3000);\n  };\n\n  const getTransactionReceiptMined = (txHash, interval) => {\n    const self = this;\n\n    const transactionReceiptAsync = async function (resolve, reject) {\n      var receipt = await web3.eth.getTransactionReceipt(txHash);\n\n      if (receipt == null) {\n        setTimeout(() => transactionReceiptAsync(resolve, reject), interval ? interval : 500);\n      } else {\n        resolve(receipt);\n      }\n    };\n\n    if (typeof txHash === \"string\") {\n      return new Promise(transactionReceiptAsync);\n    } else {\n      throw new Error(\"Invalid Type: \" + txHash);\n    }\n  };\n\n  const sendTransaction = async (userAddress, functionData, r, s, v) => {\n    if (web3 && contract) {\n      try {\n        fetch(`${config.api.prod}/api/v2/meta-tx/native`, {\n          method: \"POST\",\n          headers: {\n            \"x-api-key\": config.apiKey.prod,\n            'Content-Type': 'application/json;charset=utf-8'\n          },\n          body: JSON.stringify({\n            \"to\": config.contract.address,\n            \"apiId\": \"ab6a62bf-c58f-4040-9084-0fad85f3345a\",\n            //\"apiId\": \"f93b5089-574e-47b7-92a1-2a9fff66215a\",\n            \"params\": [userAddress, functionData, r, s, v],\n            \"from\": userAddress\n          })\n        }).then(response => response.json()).then(async function (result) {\n          console.log(result);\n          showInfoMessage(`Transaction sent by relayer with hash ${result.txHash}`);\n          let receipt = await getTransactionReceiptMined(result.txHash, 2000);\n          setTransactionHash(result.txHash);\n          showSuccessMessage(\"Transaction confirmed on chain\");\n          getQuoteFromNetwork();\n        }).catch(function (error) {\n          console.log(error);\n        });\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"section\", {\n    className: \"top-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-row-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 21\n    }\n  }, \"Library \"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 21\n    }\n  }, \"web3.js\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-row-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 21\n    }\n  }, \"Meta Transaction\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 21\n    }\n  }, \"Custom Approach\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-row-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 21\n    }\n  }, \"Signature Type\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"label-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 21\n    }\n  }, \"EIP712 Signature\"))), /*#__PURE__*/React.createElement(\"section\", {\n    className: \"main\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-wrap mb-style-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"blockquote\", {\n    cite: \"http://www.gutenberg.org/ebboks/11\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 25\n    }\n  }, quote))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-attribution\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mb-author\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 21\n    }\n  }, owner), selectedAddress.toLowerCase() === owner.toLowerCase() && /*#__PURE__*/React.createElement(\"cite\", {\n    className: \"owner\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 25\n    }\n  }, \"You are the owner of the quote\"), selectedAddress.toLowerCase() !== owner.toLowerCase() && /*#__PURE__*/React.createElement(\"cite\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 25\n    }\n  }, \"You are not the owner of the quote\"))), /*#__PURE__*/React.createElement(\"section\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 13\n    }\n  }, transactionHash !== \"\" && /*#__PURE__*/React.createElement(Box, {\n    className: classes.root,\n    mt: 2,\n    p: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 44\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 21\n    }\n  }, \"Check your transaction hash\", /*#__PURE__*/React.createElement(Link, {\n    href: `https://kovan.etherscan.io/tx/${transactionHash}`,\n    target: \"_blank\",\n    className: classes.link,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 13\n    }\n  }, \"here\")))), /*#__PURE__*/React.createElement(\"section\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"submit-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"submit-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"Enter your quote\",\n    onChange: onQuoteChange,\n    value: newQuote,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 25\n    }\n  }, \"Submit\"), /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: onSubmitWithPrivateKey,\n    style: {\n      marginLeft: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 25\n    }\n  }, \"Submit (using private key)\")))), /*#__PURE__*/React.createElement(Backdrop, {\n    className: classes.backdrop,\n    open: backdropOpen,\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(CircularProgress, {\n    color: \"inherit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      paddingLeft: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 17\n    }\n  }, loadingMessage)), /*#__PURE__*/React.createElement(NotificationContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 13\n    }\n  }));\n}\n\nexport default App;","map":{"version":3,"sources":["/home/konstantin/Документы/react_ui/src/components/Web3_Custom_EIP712Sign_API.js"],"names":["React","useState","useEffect","Button","NotificationContainer","NotificationManager","Backdrop","CircularProgress","Web3","Biconomy","makeStyles","Link","Typography","Box","sigUtil","require","config","contract","address","abi","apiKey","test","prod","api","domainType","name","type","metaTransactionType","domainData","version","verifyingContract","salt","toString","padStart","web3","walletWeb3","useStyles","theme","root","marginLeft","spacing","link","backdrop","zIndex","drawer","color","opacity","background","App","classes","preventDefault","event","backdropOpen","setBackdropOpen","loadingMessage","setLoadingMessage","quote","setQuote","owner","setOwner","newQuote","setNewQuote","selectedAddress","setSelectedAddress","metaTxEnabled","setMetaTxEnabled","transactionHash","setTransactionHash","init","window","ethereum","isMetaMask","provider","enable","kovanProvider","providers","HttpProvider","biconomy","debug","onEvent","READY","eth","Contract","getQuoteFromNetwork","on","accounts","ERROR","error","message","showErrorMessage","handleClose","handleToggle","onQuoteChange","target","value","onSubmitWithPrivateKey","console","log","privateKey","userAddress","nonce","methods","getNonce","call","functionSignature","encodeABI","parseInt","from","dataToSign","types","EIP712Domain","MetaTransaction","domain","primaryType","signature","signTypedMessage","Buffer","data","r","s","v","getSignatureParameters","sendTransaction","send","hash","showInfoMessage","once","confirmationNumber","receipt","showSuccessMessage","onSubmit","JSON","stringify","currentProvider","jsonrpc","id","method","params","response","info","result","utils","isHexStrict","Error","concat","slice","hexToNumber","includes","getQuote","then","currentQuote","undefined","currentOwner","success","getTransactionReceiptMined","txHash","interval","self","transactionReceiptAsync","resolve","reject","getTransactionReceipt","setTimeout","Promise","functionData","fetch","headers","body","json","catch","toLowerCase","paddingLeft"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAO,YAAP;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,SACIC,qBADJ,EAEIC,mBAFJ,QAGO,qBAHP;AAIA,OAAO,2CAAP;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,gBAAP,MAA6B,oCAA7B;AAEA,OAAOC,IAAP,MAAiB,MAAjB;AACA,SAAQC,QAAR,QAAuB,gBAAvB;AACA,SAASC,UAAT,QAA2B,0BAA3B;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,SAASC,GAAT,QAAoB,mBAApB;;AACA,IAAIC,OAAO,GAAGC,OAAO,CAAC,cAAD,CAArB;;AACA,IAAIC,MAAM,GAAG;AACTC,EAAAA,QAAQ,EAAE;AACNC,IAAAA,OAAO,EAAE,4CADH;AAENC,IAAAA,GAAG,EAAE,CAAC;AAAC,mBAAY,KAAb;AAAmB,gBAAS,CAAC;AAAC,mBAAU,KAAX;AAAiB,wBAAe,SAAhC;AAA0C,gBAAO,aAAjD;AAA+D,gBAAO;AAAtE,OAAD,EAAkF;AAAC,mBAAU,KAAX;AAAiB,wBAAe,gBAAhC;AAAiD,gBAAO,gBAAxD;AAAyE,gBAAO;AAAhF,OAAlF,EAA6K;AAAC,mBAAU,KAAX;AAAiB,wBAAe,OAAhC;AAAwC,gBAAO,mBAA/C;AAAmE,gBAAO;AAA1E,OAA7K,CAA5B;AAA6R,cAAO,yBAApS;AAA8T,cAAO;AAArU,KAAD,EAA+U;AAAC,gBAAS,CAAC;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,aAAjC;AAA+C,gBAAO;AAAtD,OAAD,EAAkE;AAAC,wBAAe,OAAhB;AAAwB,gBAAO,mBAA/B;AAAmD,gBAAO;AAA1D,OAAlE,EAAqI;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,MAAjC;AAAwC,gBAAO;AAA/C,OAArI,EAA+L;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,MAAjC;AAAwC,gBAAO;AAA/C,OAA/L,EAAyP;AAAC,wBAAe,OAAhB;AAAwB,gBAAO,MAA/B;AAAsC,gBAAO;AAA7C,OAAzP,CAAV;AAA0T,cAAO,wBAAjU;AAA0V,iBAAU,CAAC;AAAC,wBAAe,OAAhB;AAAwB,gBAAO,EAA/B;AAAkC,gBAAO;AAAzC,OAAD,CAApW;AAAwZ,yBAAkB,SAA1a;AAAob,cAAO;AAA3b,KAA/U,EAAsxB;AAAC,gBAAS,CAAC;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,MAAjC;AAAwC,gBAAO;AAA/C,OAAD,CAAV;AAAsE,cAAO,UAA7E;AAAwF,iBAAU,CAAC;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,OAAjC;AAAyC,gBAAO;AAAhD,OAAD,CAAlG;AAA+J,yBAAkB,MAAjL;AAAwL,cAAO;AAA/L,KAAtxB,EAAi+B;AAAC,gBAAS,EAAV;AAAa,cAAO,UAApB;AAA+B,iBAAU,CAAC;AAAC,wBAAe,QAAhB;AAAyB,gBAAO,cAAhC;AAA+C,gBAAO;AAAtD,OAAD,EAAiE;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,cAAjC;AAAgD,gBAAO;AAAvD,OAAjE,CAAzC;AAA6K,yBAAkB,MAA/L;AAAsM,cAAO;AAA7M,KAAj+B,EAA0rC;AAAC,gBAAS,EAAV;AAAa,cAAO,OAApB;AAA4B,iBAAU,CAAC;AAAC,wBAAe,SAAhB;AAA0B,gBAAO,EAAjC;AAAoC,gBAAO;AAA3C,OAAD,CAAtC;AAA8F,yBAAkB,MAAhH;AAAuH,cAAO;AAA9H,KAA1rC,EAAo0C;AAAC,gBAAS,EAAV;AAAa,cAAO,OAApB;AAA4B,iBAAU,CAAC;AAAC,wBAAe,QAAhB;AAAyB,gBAAO,EAAhC;AAAmC,gBAAO;AAA1C,OAAD,CAAtC;AAA4F,yBAAkB,MAA9G;AAAqH,cAAO;AAA5H,KAAp0C,EAA48C;AAAC,gBAAS,CAAC;AAAC,wBAAe,QAAhB;AAAyB,gBAAO,UAAhC;AAA2C,gBAAO;AAAlD,OAAD,CAAV;AAAwE,cAAO,UAA/E;AAA0F,iBAAU,EAApG;AAAuG,yBAAkB,YAAzH;AAAsI,cAAO;AAA7I,KAA58C;AAFC,GADD;AAKTC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAE,gDADF;AAEJC,IAAAA,IAAI,EAAE;AAFF,GALC;AASTC,EAAAA,GAAG,EAAE;AACDF,IAAAA,IAAI,EAAE,8BADL;AAEDC,IAAAA,IAAI,EAAE;AAFL;AATI,CAAb;AAeA,MAAME,UAAU,GAAG,CACf;AAAEC,EAAAA,IAAI,EAAE,MAAR;AAAgBC,EAAAA,IAAI,EAAE;AAAtB,CADe,EAEf;AAAED,EAAAA,IAAI,EAAE,SAAR;AAAmBC,EAAAA,IAAI,EAAE;AAAzB,CAFe,EAGf;AAAED,EAAAA,IAAI,EAAE,mBAAR;AAA6BC,EAAAA,IAAI,EAAE;AAAnC,CAHe,EAIf;AAAED,EAAAA,IAAI,EAAE,MAAR;AAAgBC,EAAAA,IAAI,EAAE;AAAtB,CAJe,CAAnB;AAOA,MAAMC,mBAAmB,GAAG,CACxB;AAAEF,EAAAA,IAAI,EAAE,OAAR;AAAiBC,EAAAA,IAAI,EAAE;AAAvB,CADwB,EAExB;AAAED,EAAAA,IAAI,EAAE,MAAR;AAAgBC,EAAAA,IAAI,EAAE;AAAtB,CAFwB,EAGxB;AAAED,EAAAA,IAAI,EAAE,mBAAR;AAA6BC,EAAAA,IAAI,EAAE;AAAnC,CAHwB,CAA5B;AAMA,IAAIE,UAAU,GAAG;AACbH,EAAAA,IAAI,EAAE,cADO;AAEbI,EAAAA,OAAO,EAAE,GAFI;AAGbC,EAAAA,iBAAiB,EAAEd,MAAM,CAACC,QAAP,CAAgBC,OAHtB;AAIba,EAAAA,IAAI,EAAE,OAAQ,EAAD,EAAKC,QAAL,CAAc,EAAd,EAAkBC,QAAlB,CAA2B,EAA3B,EAA+B,GAA/B;AAJA,CAAjB;AAOA,IAAIC,IAAJ,EAAUC,UAAV;AACA,IAAIlB,QAAJ;AAEA,MAAMmB,SAAS,GAAG1B,UAAU,CAAE2B,KAAD,KAAY;AACrCC,EAAAA,IAAI,EAAE;AACF,iBAAa;AACTC,MAAAA,UAAU,EAAEF,KAAK,CAACG,OAAN,CAAc,CAAd;AADH;AADX,GAD+B;AAMrCC,EAAAA,IAAI,EAAE;AACFF,IAAAA,UAAU,EAAE;AADV,GAN+B;AASrCG,EAAAA,QAAQ,EAAE;AACNC,IAAAA,MAAM,EAAEN,KAAK,CAACM,MAAN,CAAaC,MAAb,GAAsB,CADxB;AAENC,IAAAA,KAAK,EAAE,MAFD;AAGNC,IAAAA,OAAO,EAAE,eAHH;AAINC,IAAAA,UAAU,EAAE;AAJN;AAT2B,CAAZ,CAAD,CAA5B;;AAiBA,SAASC,GAAT,GAAe;AACX,QAAMC,OAAO,GAAGb,SAAS,EAAzB;;AACA,QAAMc,cAAc,GAAIC,KAAD,IAAWA,KAAK,CAACD,cAAN,EAAlC;;AACA,QAAM,CAACE,YAAD,EAAeC,eAAf,IAAkCrD,KAAK,CAACC,QAAN,CAAe,IAAf,CAAxC;AACA,QAAM,CAACqD,cAAD,EAAiBC,iBAAjB,IAAsCvD,KAAK,CAACC,QAAN,CAAe,0BAAf,CAA5C;AACA,QAAM,CAACuD,KAAD,EAAQC,QAAR,IAAoBxD,QAAQ,CAAC,yBAAD,CAAlC;AACA,QAAM,CAACyD,KAAD,EAAQC,QAAR,IAAoB1D,QAAQ,CAAC,uBAAD,CAAlC;AACA,QAAM,CAAC2D,QAAD,EAAWC,WAAX,IAA0B5D,QAAQ,CAAC,EAAD,CAAxC;AACA,QAAM,CAAC6D,eAAD,EAAkBC,kBAAlB,IAAwC9D,QAAQ,CAAC,EAAD,CAAtD;AACA,QAAM,CAAC+D,aAAD,EAAgBC,gBAAhB,IAAoChE,QAAQ,CAAC,IAAD,CAAlD;AACA,QAAM,CAACiE,eAAD,EAAkBC,kBAAlB,IAAwClE,QAAQ,CAAC,EAAD,CAAtD;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACZ,mBAAekE,IAAf,GAAsB;AAClB,UACI,OAAOC,MAAM,CAACC,QAAd,KAA2B,WAA3B,IACAD,MAAM,CAACC,QAAP,CAAgBC,UAFpB,EAGE;AACE;AACA,cAAMC,QAAQ,GAAGH,MAAM,CAAC,UAAD,CAAvB;AACA,cAAMG,QAAQ,CAACC,MAAT,EAAN;AACA,YAAIC,aAAa,GAAG,IAAIlE,IAAI,CAACmE,SAAL,CAAeC,YAAnB,CAAgC,6DAAhC,CAApB;AACArB,QAAAA,iBAAiB,CAAC,2BAAD,CAAjB;AACA,cAAMsB,QAAQ,GAAG,IAAIpE,QAAJ,CAAaiE,aAAb,EAA4B;AAAEtD,UAAAA,MAAM,EAAEJ,MAAM,CAACI,MAAP,CAAcE,IAAxB;AAA8BwD,UAAAA,KAAK,EAAE;AAArC,SAA5B,CAAjB,CANF,CAQE;;AACA5C,QAAAA,IAAI,GAAG,IAAI1B,IAAJ,CAASqE,QAAT,CAAP,CATF,CAWE;;AACA1C,QAAAA,UAAU,GAAG,IAAI3B,IAAJ,CAAS6D,MAAM,CAACC,QAAhB,CAAb;AAEAO,QAAAA,QAAQ,CAACE,OAAT,CAAiBF,QAAQ,CAACG,KAA1B,EAAiC,MAAM;AACnC;AACA/D,UAAAA,QAAQ,GAAG,IAAIiB,IAAI,CAAC+C,GAAL,CAASC,QAAb,CACPlE,MAAM,CAACC,QAAP,CAAgBE,GADT,EAEPH,MAAM,CAACC,QAAP,CAAgBC,OAFT,CAAX;AAIA6C,UAAAA,kBAAkB,CAACS,QAAQ,CAACV,eAAV,CAAlB;AACAqB,UAAAA,mBAAmB;AACnBX,UAAAA,QAAQ,CAACY,EAAT,CAAY,iBAAZ,EAA+B,UAAUC,QAAV,EAAoB;AAC/CtB,YAAAA,kBAAkB,CAACsB,QAAQ,CAAC,CAAD,CAAT,CAAlB;AACH,WAFD;AAGH,SAXD,EAWGN,OAXH,CAWWF,QAAQ,CAACS,KAXpB,EAW2B,CAACC,KAAD,EAAQC,OAAR,KAAoB,CAC3C;AACH,SAbD;AAcH,OA/BD,MA+BO;AACHC,QAAAA,gBAAgB,CAAC,wBAAD,CAAhB;AACH;AACJ;;AACDrB,IAAAA,IAAI;AACP,GAtCQ,EAsCN,EAtCM,CAAT;;AAwCA,QAAMsB,WAAW,GAAG,MAAM;AACtBrC,IAAAA,eAAe,CAAC,KAAD,CAAf;AACH,GAFD;;AAIA,QAAMsC,YAAY,GAAG,MAAM;AACvBtC,IAAAA,eAAe,CAAC,CAACD,YAAF,CAAf;AACH,GAFD;;AAIA,QAAMwC,aAAa,GAAGzC,KAAK,IAAI;AAC3BU,IAAAA,WAAW,CAACV,KAAK,CAAC0C,MAAN,CAAaC,KAAd,CAAX;AACH,GAFD;;AAIA,QAAMC,sBAAsB,GAAG,YAAY;AACvC,QAAInC,QAAQ,IAAI,EAAZ,IAAkB3C,QAAtB,EAAgC;AAC5BkD,MAAAA,kBAAkB,CAAC,EAAD,CAAlB;;AACA,UAAIH,aAAJ,EAAmB;AACfgC,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACA,YAAIC,UAAU,GAAG,kEAAjB;AACA,YAAIC,WAAW,GAAG,4CAAlB;AACA,YAAIC,KAAK,GAAG,MAAMnF,QAAQ,CAACoF,OAAT,CAAiBC,QAAjB,CAA0BH,WAA1B,EAAuCI,IAAvC,EAAlB;AACA,YAAIC,iBAAiB,GAAGvF,QAAQ,CAACoF,OAAT,CAAiB5C,QAAjB,CAA0BG,QAA1B,EAAoC6C,SAApC,EAAxB;AACA,YAAIjB,OAAO,GAAG,EAAd;AACAA,QAAAA,OAAO,CAACY,KAAR,GAAgBM,QAAQ,CAACN,KAAD,CAAxB;AACAZ,QAAAA,OAAO,CAACmB,IAAR,GAAeR,WAAf;AACAX,QAAAA,OAAO,CAACgB,iBAAR,GAA4BA,iBAA5B;AAEA,cAAMI,UAAU,GAAG;AACfC,UAAAA,KAAK,EAAE;AACHC,YAAAA,YAAY,EAAEtF,UADX;AAEHuF,YAAAA,eAAe,EAAEpF;AAFd,WADQ;AAKfqF,UAAAA,MAAM,EAAEpF,UALO;AAMfqF,UAAAA,WAAW,EAAE,iBANE;AAOfzB,UAAAA,OAAO,EAAEA;AAPM,SAAnB;AAUA,cAAM0B,SAAS,GAAGpG,OAAO,CAACqG,gBAAR,CAAyB,IAAIC,MAAM,CAACT,IAAX,CAAgBT,UAAhB,EAA4B,KAA5B,CAAzB,EAA6D;AAAEmB,UAAAA,IAAI,EAAET;AAAR,SAA7D,EAAmF,IAAnF,CAAlB;AACA,YAAI;AAAEU,UAAAA,CAAF;AAAKC,UAAAA,CAAL;AAAQC,UAAAA;AAAR,YAAcC,sBAAsB,CAACP,SAAD,CAAxC;AACAQ,QAAAA,eAAe,CAACvB,WAAD,EAAcK,iBAAd,EAAiCc,CAAjC,EAAoCC,CAApC,EAAuCC,CAAvC,CAAf;AACH,OAxBD,MAwBO;AACHxB,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAhF,QAAAA,QAAQ,CAACoF,OAAT,CACK5C,QADL,CACcG,QADd,EAEK+D,IAFL,CAEU;AAAEhB,UAAAA,IAAI,EAAE7C;AAAR,SAFV,EAGKsB,EAHL,CAGQ,iBAHR,EAG2B,UAAUwC,IAAV,EAAgB;AACnCC,UAAAA,eAAe,CAAE,4CAA2CD,IAAK,EAAlD,CAAf;AACH,SALL,EAMKE,IANL,CAMU,cANV,EAM0B,UAAUC,kBAAV,EAA8BC,OAA9B,EAAuC;AACzD7D,UAAAA,kBAAkB,CAAC6D,OAAO,CAAC9D,eAAT,CAAlB;AACA+D,UAAAA,kBAAkB,CAAC,uBAAD,CAAlB;AACA9C,UAAAA,mBAAmB;AACtB,SAVL;AAWH;AACJ,KAxCD,MAwCO;AACHM,MAAAA,gBAAgB,CAAC,wBAAD,CAAhB;AACH;AACJ,GA5CD;;AA8CA,QAAMyC,QAAQ,GAAG,MAAM/E,KAAN,IAAe;AAC5B,QAAIS,QAAQ,IAAI,EAAZ,IAAkB3C,QAAtB,EAAgC;AAC5BkD,MAAAA,kBAAkB,CAAC,EAAD,CAAlB;;AACA,UAAIH,aAAJ,EAAmB;AACfgC,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACA,YAAIE,WAAW,GAAGrC,eAAlB;AACA,YAAIsC,KAAK,GAAG,MAAMnF,QAAQ,CAACoF,OAAT,CAAiBC,QAAjB,CAA0BH,WAA1B,EAAuCI,IAAvC,EAAlB;AACA,YAAIC,iBAAiB,GAAGvF,QAAQ,CAACoF,OAAT,CAAiB5C,QAAjB,CAA0BG,QAA1B,EAAoC6C,SAApC,EAAxB;AACA,YAAIjB,OAAO,GAAG,EAAd;AACAA,QAAAA,OAAO,CAACY,KAAR,GAAgBM,QAAQ,CAACN,KAAD,CAAxB;AACAZ,QAAAA,OAAO,CAACmB,IAAR,GAAeR,WAAf;AACAX,QAAAA,OAAO,CAACgB,iBAAR,GAA4BA,iBAA5B;AAEA,cAAMI,UAAU,GAAGuB,IAAI,CAACC,SAAL,CAAe;AAC9BvB,UAAAA,KAAK,EAAE;AACHC,YAAAA,YAAY,EAAEtF,UADX;AAEHuF,YAAAA,eAAe,EAAEpF;AAFd,WADuB;AAK9BqF,UAAAA,MAAM,EAAEpF,UALsB;AAM9BqF,UAAAA,WAAW,EAAE,iBANiB;AAO9BzB,UAAAA,OAAO,EAAEA;AAPqB,SAAf,CAAnB,CAVe,CAoBf;;AACArD,QAAAA,UAAU,CAACkG,eAAX,CAA2BV,IAA3B,CACI;AACIW,UAAAA,OAAO,EAAE,KADb;AAEIC,UAAAA,EAAE,EAAE,YAFR;AAGIC,UAAAA,MAAM,EAAE,sBAHZ;AAIIC,UAAAA,MAAM,EAAE,CAACtC,WAAD,EAAcS,UAAd;AAJZ,SADJ,EAOI,UAAUrB,KAAV,EAAiBmD,QAAjB,EAA2B;AACvB1C,UAAAA,OAAO,CAAC2C,IAAR,CAAc,qBAAoBD,QAAQ,CAACE,MAAO,EAAlD;;AACA,cAAIrD,KAAK,IAAKmD,QAAQ,IAAIA,QAAQ,CAACnD,KAAnC,EAA2C;AACvCE,YAAAA,gBAAgB,CAAC,8BAAD,CAAhB;AACH,WAFD,MAEO,IAAIiD,QAAQ,IAAIA,QAAQ,CAACE,MAAzB,EAAiC;AACpC,gBAAI;AAAEtB,cAAAA,CAAF;AAAKC,cAAAA,CAAL;AAAQC,cAAAA;AAAR,gBAAcC,sBAAsB,CAACiB,QAAQ,CAACE,MAAV,CAAxC;AACAlB,YAAAA,eAAe,CAACvB,WAAD,EAAcK,iBAAd,EAAiCc,CAAjC,EAAoCC,CAApC,EAAuCC,CAAvC,CAAf;AACH;AACJ,SAfL;AAiBH,OAtCD,MAsCO;AACHxB,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACAhF,QAAAA,QAAQ,CAACoF,OAAT,CACK5C,QADL,CACcG,QADd,EAEK+D,IAFL,CAEU;AAAEhB,UAAAA,IAAI,EAAE7C;AAAR,SAFV,EAGKsB,EAHL,CAGQ,iBAHR,EAG2B,UAAUwC,IAAV,EAAgB;AACnCC,UAAAA,eAAe,CAAE,4CAA2CD,IAAK,EAAlD,CAAf;AACH,SALL,EAMKE,IANL,CAMU,cANV,EAM0B,UAAUC,kBAAV,EAA8BC,OAA9B,EAAuC;AACzD7D,UAAAA,kBAAkB,CAAC6D,OAAO,CAAC9D,eAAT,CAAlB;AACA+D,UAAAA,kBAAkB,CAAC,uBAAD,CAAlB;AACA9C,UAAAA,mBAAmB;AACtB,SAVL;AAWH;AACJ,KAtDD,MAsDO;AACHM,MAAAA,gBAAgB,CAAC,wBAAD,CAAhB;AACH;AACJ,GA1DD;;AA4DA,QAAMgC,sBAAsB,GAAGP,SAAS,IAAI;AACxC,QAAI,CAAChF,IAAI,CAAC2G,KAAL,CAAWC,WAAX,CAAuB5B,SAAvB,CAAL,EAAwC;AACpC,YAAM,IAAI6B,KAAJ,CACF,gBAAgBC,MAAhB,CAAuB9B,SAAvB,EAAkC,8BAAlC,CADE,CAAN;AAGH;;AACD,QAAII,CAAC,GAAGJ,SAAS,CAAC+B,KAAV,CAAgB,CAAhB,EAAmB,EAAnB,CAAR;AACA,QAAI1B,CAAC,GAAG,KAAKyB,MAAL,CAAY9B,SAAS,CAAC+B,KAAV,CAAgB,EAAhB,EAAoB,GAApB,CAAZ,CAAR;AACA,QAAIzB,CAAC,GAAG,KAAKwB,MAAL,CAAY9B,SAAS,CAAC+B,KAAV,CAAgB,GAAhB,EAAqB,GAArB,CAAZ,CAAR;AACAzB,IAAAA,CAAC,GAAGtF,IAAI,CAAC2G,KAAL,CAAWK,WAAX,CAAuB1B,CAAvB,CAAJ;AACA,QAAI,CAAC,CAAC,EAAD,EAAK,EAAL,EAAS2B,QAAT,CAAkB3B,CAAlB,CAAL,EAA2BA,CAAC,IAAI,EAAL;AAC3B,WAAO;AACHF,MAAAA,CAAC,EAAEA,CADA;AAEHC,MAAAA,CAAC,EAAEA,CAFA;AAGHC,MAAAA,CAAC,EAAEA;AAHA,KAAP;AAKH,GAhBD;;AAkBA,QAAMrC,mBAAmB,GAAG,MAAM;AAC9B5B,IAAAA,iBAAiB,CAAC,gCAAD,CAAjB;;AACA,QAAI;AACA,UAAIrB,IAAI,IAAIjB,QAAZ,EAAsB;AAClBA,QAAAA,QAAQ,CAACoF,OAAT,CACK+C,QADL,GAEK7C,IAFL,GAGK8C,IAHL,CAGU,UAAUT,MAAV,EAAkB;AACpBlD,UAAAA,WAAW;AACXM,UAAAA,OAAO,CAACC,GAAR,CAAY2C,MAAZ;;AACA,cACIA,MAAM,IACNA,MAAM,CAACU,YAAP,IAAuBC,SADvB,IAEAX,MAAM,CAACY,YAAP,IAAuBD,SAH3B,EAIE;AACE,gBAAIX,MAAM,CAACU,YAAP,IAAuB,EAA3B,EAA+B;AAC3B7D,cAAAA,gBAAgB,CAAC,iCAAD,CAAhB;AACH,aAFD,MAEO;AACHhC,cAAAA,QAAQ,CAACmF,MAAM,CAACU,YAAR,CAAR;AACA3F,cAAAA,QAAQ,CAACiF,MAAM,CAACY,YAAR,CAAR;AACH;AACJ,WAXD,MAWO;AACH/D,YAAAA,gBAAgB,CAAC,gDAAD,CAAhB;AACH;AACJ,SApBL;AAqBH,OAtBD,MAsBO;AACHC,QAAAA,WAAW;AACd;AACJ,KA1BD,CA0BE,OAAMH,KAAN,EAAa;AACXG,MAAAA,WAAW;AACXM,MAAAA,OAAO,CAACC,GAAR,CAAYV,KAAZ;AACH;AACJ,GAhCD;;AAkCA,QAAME,gBAAgB,GAAGD,OAAO,IAAI;AAChCnF,IAAAA,mBAAmB,CAACkF,KAApB,CAA0BC,OAA1B,EAAmC,OAAnC,EAA4C,IAA5C;AACH,GAFD;;AAIA,QAAMyC,kBAAkB,GAAGzC,OAAO,IAAI;AAClCnF,IAAAA,mBAAmB,CAACoJ,OAApB,CAA4BjE,OAA5B,EAAqC,SAArC,EAAgD,IAAhD;AACH,GAFD;;AAIA,QAAMqC,eAAe,GAAGrC,OAAO,IAAI;AAC/BnF,IAAAA,mBAAmB,CAACsI,IAApB,CAAyBnD,OAAzB,EAAkC,MAAlC,EAA0C,IAA1C;AACH,GAFD;;AAIA,QAAMkE,0BAA0B,GAAG,CAACC,MAAD,EAASC,QAAT,KAAsB;AACrD,UAAMC,IAAI,GAAG,IAAb;;AACA,UAAMC,uBAAuB,GAAG,gBAAeC,OAAf,EAAwBC,MAAxB,EAAgC;AAC9D,UAAIhC,OAAO,GAAG,MAAM9F,IAAI,CAAC+C,GAAL,CAASgF,qBAAT,CAA+BN,MAA/B,CAApB;;AACA,UAAI3B,OAAO,IAAI,IAAf,EAAqB;AACjBkC,QAAAA,UAAU,CACN,MAAMJ,uBAAuB,CAACC,OAAD,EAAUC,MAAV,CADvB,EAENJ,QAAQ,GAAGA,QAAH,GAAc,GAFhB,CAAV;AAGH,OAJD,MAIO;AACHG,QAAAA,OAAO,CAAC/B,OAAD,CAAP;AACH;AACF,KATD;;AAWA,QAAI,OAAO2B,MAAP,KAAkB,QAAtB,EAAgC;AAC5B,aAAO,IAAIQ,OAAJ,CAAYL,uBAAZ,CAAP;AACH,KAFD,MAEO;AACH,YAAM,IAAIf,KAAJ,CAAU,mBAAmBY,MAA7B,CAAN;AACH;AACF,GAlBH;;AAoBA,QAAMjC,eAAe,GAAG,OAAOvB,WAAP,EAAoBiE,YAApB,EAAkC9C,CAAlC,EAAqCC,CAArC,EAAwCC,CAAxC,KAA8C;AAClE,QAAItF,IAAI,IAAIjB,QAAZ,EAAsB;AAClB,UAAI;AACAoJ,QAAAA,KAAK,CAAE,GAAErJ,MAAM,CAACO,GAAP,CAAWD,IAAK,wBAApB,EAA6C;AAC9CkH,UAAAA,MAAM,EAAE,MADsC;AAE9C8B,UAAAA,OAAO,EAAE;AACP,yBAActJ,MAAM,CAACI,MAAP,CAAcE,IADrB;AAEP,4BAAgB;AAFT,WAFqC;AAM9CiJ,UAAAA,IAAI,EAAEpC,IAAI,CAACC,SAAL,CAAe;AACnB,kBAAMpH,MAAM,CAACC,QAAP,CAAgBC,OADH;AAEnB,qBAAS,sCAFU;AAGnB;AACA,sBAAU,CAACiF,WAAD,EAAciE,YAAd,EAA4B9C,CAA5B,EAA+BC,CAA/B,EAAkCC,CAAlC,CAJS;AAKnB,oBAAQrB;AALW,WAAf;AANwC,SAA7C,CAAL,CAcGkD,IAdH,CAcQX,QAAQ,IAAEA,QAAQ,CAAC8B,IAAT,EAdlB,EAeGnB,IAfH,CAeQ,gBAAeT,MAAf,EAAuB;AAC3B5C,UAAAA,OAAO,CAACC,GAAR,CAAY2C,MAAZ;AACAf,UAAAA,eAAe,CAAE,yCAAwCe,MAAM,CAACe,MAAO,EAAxD,CAAf;AAEA,cAAI3B,OAAO,GAAG,MAAM0B,0BAA0B,CAACd,MAAM,CAACe,MAAR,EAAgB,IAAhB,CAA9C;AACAxF,UAAAA,kBAAkB,CAACyE,MAAM,CAACe,MAAR,CAAlB;AACA1B,UAAAA,kBAAkB,CAAC,gCAAD,CAAlB;AACA9C,UAAAA,mBAAmB;AACpB,SAvBH,EAuBKsF,KAvBL,CAuBW,UAASlF,KAAT,EAAgB;AACrBS,UAAAA,OAAO,CAACC,GAAR,CAAYV,KAAZ;AACD,SAzBL;AA0BH,OA3BD,CA2BE,OAAOA,KAAP,EAAc;AACZS,QAAAA,OAAO,CAACC,GAAR,CAAYV,KAAZ;AACH;AACJ;AACJ,GAjCD;;AAmCA,sBACI;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAS,IAAA,SAAS,EAAC,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAM,IAAA,SAAS,EAAC,OAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAEI;AAAM,IAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAFJ,CADJ,eAKI;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAM,IAAA,SAAS,EAAC,OAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,eAEI;AAAM,IAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAFJ,CALJ,eASI;AAAK,IAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAM,IAAA,SAAS,EAAC,OAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADJ,eAEI;AAAM,IAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFJ,CATJ,CADJ,eAeI;AAAS,IAAA,SAAS,EAAC,MAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAY,IAAA,IAAI,EAAC,oCAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAI/B,KAAJ,CADJ,CADJ,CADJ,eAOI;AAAK,IAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAG,IAAA,SAAS,EAAC,WAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA0BE,KAA1B,CADJ,EAEKI,eAAe,CAAC4G,WAAhB,OAAkChH,KAAK,CAACgH,WAAN,EAAlC,iBACG;AAAM,IAAA,SAAS,EAAC,OAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAHR,EAKK5G,eAAe,CAAC4G,WAAhB,OAAkChH,KAAK,CAACgH,WAAN,EAAlC,iBACG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CANR,CAPJ,CAfJ,eAgCI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKxG,eAAe,KAAK,EAApB,iBAA0B,oBAAC,GAAD;AAAK,IAAA,SAAS,EAAEjB,OAAO,CAACX,IAAxB;AAA8B,IAAA,EAAE,EAAE,CAAlC;AAAqC,IAAA,CAAC,EAAE,CAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACvB,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDAER,oBAAC,IAAD;AAAM,IAAA,IAAI,EAAG,iCAAgC4B,eAAgB,EAA7D;AAAgE,IAAA,MAAM,EAAC,QAAvE;AACgB,IAAA,SAAS,EAAEjB,OAAO,CAACR,IADnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFQ,CADuB,CAD/B,CAhCJ,eA2CI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AACI,IAAA,IAAI,EAAC,MADT;AAEI,IAAA,WAAW,EAAC,kBAFhB;AAGI,IAAA,QAAQ,EAAEmD,aAHd;AAII,IAAA,KAAK,EAAEhC,QAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,eAOI,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,WAAhB;AAA4B,IAAA,KAAK,EAAC,SAAlC;AAA4C,IAAA,OAAO,EAAEsE,QAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAPJ,eAUI,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,WAAhB;AAA4B,IAAA,KAAK,EAAC,SAAlC;AAA4C,IAAA,OAAO,EAAEnC,sBAArD;AAA6E,IAAA,KAAK,EAAE;AAAExD,MAAAA,UAAU,EAAE;AAAd,KAApF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAVJ,CADJ,CADJ,CA3CJ,eA6DI,oBAAC,QAAD;AAAU,IAAA,SAAS,EAAEU,OAAO,CAACP,QAA7B;AAAuC,IAAA,IAAI,EAAEU,YAA7C;AAA2D,IAAA,OAAO,EAAEsC,WAApE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,gBAAD;AAAkB,IAAA,KAAK,EAAC,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,eAEI;AAAK,IAAA,KAAK,EAAE;AAAEiF,MAAAA,WAAW,EAAE;AAAf,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAsCrH,cAAtC,CAFJ,CA7DJ,eAiEI,oBAAC,qBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAjEJ,CADJ;AAqEH;;AAED,eAAeN,GAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport \"../App.css\";\nimport Button from \"@material-ui/core/Button\";\nimport {\n    NotificationContainer,\n    NotificationManager\n} from \"react-notifications\";\nimport \"react-notifications/lib/notifications.css\";\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport Web3 from \"web3\";\nimport {Biconomy} from \"@biconomy/mexa\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport Link from '@material-ui/core/Link';\nimport Typography from '@material-ui/core/Typography';\nimport { Box } from \"@material-ui/core\";\nlet sigUtil = require(\"eth-sig-util\");\nlet config = {\n    contract: {\n        address: \"0x853bfD0160d67DF13a9F70409f9038f6473585Bd\",\n        abi: [{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"userAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"addresspayable\",\"name\":\"relayerAddress\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"bytes\",\"name\":\"functionSignature\",\"type\":\"bytes\"}],\"name\":\"MetaTransactionExecuted\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"userAddress\",\"type\":\"address\"},{\"internalType\":\"bytes\",\"name\":\"functionSignature\",\"type\":\"bytes\"},{\"internalType\":\"bytes32\",\"name\":\"sigR\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"sigS\",\"type\":\"bytes32\"},{\"internalType\":\"uint8\",\"name\":\"sigV\",\"type\":\"uint8\"}],\"name\":\"executeMetaTransaction\",\"outputs\":[{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"}],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"}],\"name\":\"getNonce\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"nonce\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getQuote\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"currentQuote\",\"type\":\"string\"},{\"internalType\":\"address\",\"name\":\"currentOwner\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"quote\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"newQuote\",\"type\":\"string\"}],\"name\":\"setQuote\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]\n    },\n    apiKey: {\n        test: \"cNWqZcoBb.4e4c0990-26a8-4a45-b98e-08101f754119\",\n        prod: \"8nvA_lM_Q.0424c54e-b4b2-4550-98c5-8b437d3118a9\"\n    },\n    api: {\n        test: \"https://test-api.biconomy.io\",\n        prod: \"https://api.biconomy.io\"\n    }\n}\n\nconst domainType = [\n    { name: \"name\", type: \"string\" },\n    { name: \"version\", type: \"string\" },\n    { name: \"verifyingContract\", type: \"address\" },\n    { name: \"salt\", type: \"bytes32\" },\n];\n\nconst metaTransactionType = [\n    { name: \"nonce\", type: \"uint256\" },\n    { name: \"from\", type: \"address\" },\n    { name: \"functionSignature\", type: \"bytes\" }\n];\n\nlet domainData = {\n    name: \"TestContract\",\n    version: \"1\",\n    verifyingContract: config.contract.address,\n    salt: '0x' + (42).toString(16).padStart(64, '0')\n};\n\nlet web3, walletWeb3;\nlet contract;\n\nconst useStyles = makeStyles((theme) => ({\n    root: {\n        '& > * + *': {\n            marginLeft: theme.spacing(2),\n        },\n    },\n    link: {\n        marginLeft: \"5px\"\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n        opacity: '.85!important',\n        background: '#000'\n    },\n}));\n\nfunction App() {\n    const classes = useStyles();\n    const preventDefault = (event) => event.preventDefault();\n    const [backdropOpen, setBackdropOpen] = React.useState(true);\n    const [loadingMessage, setLoadingMessage] = React.useState(\" Loading Application ...\");\n    const [quote, setQuote] = useState(\"This is a default quote\");\n    const [owner, setOwner] = useState(\"Default Owner Address\");\n    const [newQuote, setNewQuote] = useState(\"\");\n    const [selectedAddress, setSelectedAddress] = useState(\"\");\n    const [metaTxEnabled, setMetaTxEnabled] = useState(true);\n    const [transactionHash, setTransactionHash] = useState(\"\");\n\n    useEffect(() => {\n        async function init() {\n            if (\n                typeof window.ethereum !== \"undefined\" &&\n                window.ethereum.isMetaMask\n            ) {\n                // Ethereum user detected. You can now use the provider.\n                const provider = window[\"ethereum\"];\n                await provider.enable();\n                let kovanProvider = new Web3.providers.HttpProvider(\"https://kovan.infura.io/v3/d126f392798444609246423b06116c77\");\n                setLoadingMessage(\"Initializing Biconomy ...\");\n                const biconomy = new Biconomy(kovanProvider, { apiKey: config.apiKey.prod, debug: true });\n\n                // This web3 instance is used to read normally and write to contract via meta transactions.\n                web3 = new Web3(biconomy);\n\n                // This web3 instance is used to get user signature from connected wallet\n                walletWeb3 = new Web3(window.ethereum);\n\n                biconomy.onEvent(biconomy.READY, () => {\n                    // Initialize your dapp here like getting user accounts etc\n                    contract = new web3.eth.Contract(\n                        config.contract.abi,\n                        config.contract.address\n                    );\n                    setSelectedAddress(provider.selectedAddress);\n                    getQuoteFromNetwork();\n                    provider.on(\"accountsChanged\", function (accounts) {\n                        setSelectedAddress(accounts[0]);\n                    });\n                }).onEvent(biconomy.ERROR, (error, message) => {\n                    // Handle error while initializing mexa\n                });\n            } else {\n                showErrorMessage(\"Metamask not installed\");\n            }\n        }\n        init();\n    }, []);\n\n    const handleClose = () => {\n        setBackdropOpen(false);\n    };\n\n    const handleToggle = () => {\n        setBackdropOpen(!backdropOpen);\n    };\n\n    const onQuoteChange = event => {\n        setNewQuote(event.target.value);\n    };\n\n    const onSubmitWithPrivateKey = async () => {\n        if (newQuote != \"\" && contract) {\n            setTransactionHash(\"\");\n            if (metaTxEnabled) {\n                console.log(\"Sending meta transaction\");\n                let privateKey = \"2ef295b86aa9d40ff8835a9fe852942ccea0b7c757fad5602dfa429bcdaea910\";\n                let userAddress = \"0xE1E763551A85F04B4687f0035885E7F710A46aA6\";\n                let nonce = await contract.methods.getNonce(userAddress).call();\n                let functionSignature = contract.methods.setQuote(newQuote).encodeABI();\n                let message = {};\n                message.nonce = parseInt(nonce);\n                message.from = userAddress;\n                message.functionSignature = functionSignature;\n\n                const dataToSign = {\n                    types: {\n                        EIP712Domain: domainType,\n                        MetaTransaction: metaTransactionType\n                    },\n                    domain: domainData,\n                    primaryType: \"MetaTransaction\",\n                    message: message\n                };\n\n                const signature = sigUtil.signTypedMessage(new Buffer.from(privateKey, 'hex'), { data: dataToSign }, 'V4');\n                let { r, s, v } = getSignatureParameters(signature);\n                sendTransaction(userAddress, functionSignature, r, s, v);\n            } else {\n                console.log(\"Sending normal transaction\");\n                contract.methods\n                    .setQuote(newQuote)\n                    .send({ from: selectedAddress })\n                    .on(\"transactionHash\", function (hash) {\n                        showInfoMessage(`Transaction sent to blockchain with hash ${hash}`);\n                    })\n                    .once(\"confirmation\", function (confirmationNumber, receipt) {\n                        setTransactionHash(receipt.transactionHash);\n                        showSuccessMessage(\"Transaction confirmed\");\n                        getQuoteFromNetwork();\n                    });\n            }\n        } else {\n            showErrorMessage(\"Please enter the quote\");\n        }\n    }\n\n    const onSubmit = async event => {\n        if (newQuote != \"\" && contract) {\n            setTransactionHash(\"\");\n            if (metaTxEnabled) {\n                console.log(\"Sending meta transaction\");\n                let userAddress = selectedAddress;\n                let nonce = await contract.methods.getNonce(userAddress).call();\n                let functionSignature = contract.methods.setQuote(newQuote).encodeABI();\n                let message = {};\n                message.nonce = parseInt(nonce);\n                message.from = userAddress;\n                message.functionSignature = functionSignature;\n\n                const dataToSign = JSON.stringify({\n                    types: {\n                        EIP712Domain: domainType,\n                        MetaTransaction: metaTransactionType\n                    },\n                    domain: domainData,\n                    primaryType: \"MetaTransaction\",\n                    message: message\n                });\n                \n                // NOTE: Using walletWeb3 here, as it is connected to the wallet where user account is present.\n                walletWeb3.currentProvider.send(\n                    {\n                        jsonrpc: \"2.0\",\n                        id: 999999999999,\n                        method: \"eth_signTypedData_v4\",\n                        params: [userAddress, dataToSign]\n                    },\n                    function (error, response) {\n                        console.info(`User signature is ${response.result}`);\n                        if (error || (response && response.error)) {\n                            showErrorMessage(\"Could not get user signature\");\n                        } else if (response && response.result) {\n                            let { r, s, v } = getSignatureParameters(response.result);\n                            sendTransaction(userAddress, functionSignature, r, s, v);\n                        }\n                    }\n                );\n            } else {\n                console.log(\"Sending normal transaction\");\n                contract.methods\n                    .setQuote(newQuote)\n                    .send({ from: selectedAddress })\n                    .on(\"transactionHash\", function (hash) {\n                        showInfoMessage(`Transaction sent to blockchain with hash ${hash}`);\n                    })\n                    .once(\"confirmation\", function (confirmationNumber, receipt) {\n                        setTransactionHash(receipt.transactionHash);\n                        showSuccessMessage(\"Transaction confirmed\");\n                        getQuoteFromNetwork();\n                    });\n            }\n        } else {\n            showErrorMessage(\"Please enter the quote\");\n        }\n    };\n\n    const getSignatureParameters = signature => {\n        if (!web3.utils.isHexStrict(signature)) {\n            throw new Error(\n                'Given value \"'.concat(signature, '\" is not a valid hex string.')\n            );\n        }\n        var r = signature.slice(0, 66);\n        var s = \"0x\".concat(signature.slice(66, 130));\n        var v = \"0x\".concat(signature.slice(130, 132));\n        v = web3.utils.hexToNumber(v);\n        if (![27, 28].includes(v)) v += 27;\n        return {\n            r: r,\n            s: s,\n            v: v\n        };\n    };\n\n    const getQuoteFromNetwork = () => {\n        setLoadingMessage(\"Getting Quote from contact ...\");\n        try {\n            if (web3 && contract) {\n                contract.methods\n                    .getQuote()\n                    .call()\n                    .then(function (result) {\n                        handleClose();\n                        console.log(result);\n                        if (\n                            result &&\n                            result.currentQuote != undefined &&\n                            result.currentOwner != undefined\n                        ) {\n                            if (result.currentQuote == \"\") {\n                                showErrorMessage(\"No quotes set on blockchain yet\");\n                            } else {\n                                setQuote(result.currentQuote);\n                                setOwner(result.currentOwner);\n                            }\n                        } else {\n                            showErrorMessage(\"Not able to get quote information from Network\");\n                        }\n                    });\n            } else {\n                handleClose();\n            }\n        } catch(error) {\n            handleClose();\n            console.log(error);\n        }\n    };\n\n    const showErrorMessage = message => {\n        NotificationManager.error(message, \"Error\", 5000);\n    };\n\n    const showSuccessMessage = message => {\n        NotificationManager.success(message, \"Message\", 3000);\n    };\n\n    const showInfoMessage = message => {\n        NotificationManager.info(message, \"Info\", 3000);\n    };\n\n    const getTransactionReceiptMined = (txHash, interval) => {\n        const self = this;\n        const transactionReceiptAsync = async function(resolve, reject) {\n          var receipt = await web3.eth.getTransactionReceipt(txHash);\n          if (receipt == null) {\n              setTimeout(\n                  () => transactionReceiptAsync(resolve, reject),\n                  interval ? interval : 500);\n          } else {\n              resolve(receipt);\n          }\n        };\n    \n        if (typeof txHash === \"string\") {\n            return new Promise(transactionReceiptAsync);\n        } else {\n            throw new Error(\"Invalid Type: \" + txHash);\n        }\n      };\n\n    const sendTransaction = async (userAddress, functionData, r, s, v) => {\n        if (web3 && contract) {\n            try {\n                fetch(`${config.api.prod}/api/v2/meta-tx/native`, {\n                    method: \"POST\",\n                    headers: {\n                      \"x-api-key\" : config.apiKey.prod,\n                      'Content-Type': 'application/json;charset=utf-8'\n                    },\n                    body: JSON.stringify({\n                      \"to\": config.contract.address,\n                      \"apiId\": \"ab6a62bf-c58f-4040-9084-0fad85f3345a\",\n                      //\"apiId\": \"f93b5089-574e-47b7-92a1-2a9fff66215a\",\n                      \"params\": [userAddress, functionData, r, s, v],\n                      \"from\": userAddress\n                    })\n                  })\n                  .then(response=>response.json())\n                  .then(async function(result) {\n                    console.log(result);\n                    showInfoMessage(`Transaction sent by relayer with hash ${result.txHash}`);\n          \n                    let receipt = await getTransactionReceiptMined(result.txHash, 2000);\n                    setTransactionHash(result.txHash);\n                    showSuccessMessage(\"Transaction confirmed on chain\");\n                    getQuoteFromNetwork();\n                  }).catch(function(error) {\n                      console.log(error)\n                    });\n            } catch (error) {\n                console.log(error);\n            }\n        }\n    };\n\n    return (\n        <div className=\"App\">\n            <section className=\"top-row\">\n                <div className=\"top-row-item\">\n                    <span className=\"label\">Library </span>\n                    <span className=\"label-value\">web3.js</span>\n                </div>\n                <div className=\"top-row-item\">\n                    <span className=\"label\">Meta Transaction</span>\n                    <span className=\"label-value\">Custom Approach</span>\n                </div>\n                <div className=\"top-row-item\">\n                    <span className=\"label\">Signature Type</span>\n                    <span className=\"label-value\">EIP712 Signature</span>\n                </div>\n            </section>\n            <section className=\"main\">\n                <div className=\"mb-wrap mb-style-2\">\n                    <blockquote cite=\"http://www.gutenberg.org/ebboks/11\">\n                        <p>{quote}</p>\n                    </blockquote>\n                </div>\n\n                <div className=\"mb-attribution\">\n                    <p className=\"mb-author\">{owner}</p>\n                    {selectedAddress.toLowerCase() === owner.toLowerCase() && (\n                        <cite className=\"owner\">You are the owner of the quote</cite>\n                    )}\n                    {selectedAddress.toLowerCase() !== owner.toLowerCase() && (\n                        <cite>You are not the owner of the quote</cite>\n                    )}\n                </div>\n            </section>\n            <section>\n                {transactionHash !== \"\" && <Box className={classes.root} mt={2} p={2}>\n                    <Typography>\n                        Check your transaction hash\n            <Link href={`https://kovan.etherscan.io/tx/${transactionHash}`} target=\"_blank\"\n                            className={classes.link}>\n                            here\n            </Link>\n                    </Typography>\n                </Box>}\n            </section>\n            <section>\n                <div className=\"submit-container\">\n                    <div className=\"submit-row\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"Enter your quote\"\n                            onChange={onQuoteChange}\n                            value={newQuote}\n                        />\n                        <Button variant=\"contained\" color=\"primary\" onClick={onSubmit}>\n                            Submit\n            </Button>\n                        <Button variant=\"contained\" color=\"primary\" onClick={onSubmitWithPrivateKey} style={{ marginLeft: \"10px\" }}>\n                            Submit (using private key)\n            </Button>\n                    </div>\n                </div>\n            </section>\n            <Backdrop className={classes.backdrop} open={backdropOpen} onClick={handleClose}>\n                <CircularProgress color=\"inherit\" />\n                <div style={{ paddingLeft: \"10px\" }}>{loadingMessage}</div>\n            </Backdrop>\n            <NotificationContainer />\n        </div>\n    );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}